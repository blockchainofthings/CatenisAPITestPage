<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Test Catenis API</title>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
        <script src="lib/CatenisAPIClientJS.min.js"></script>
        <script language="JavaScript">
            var ctnApiClient;
            var device = {};
            var lastMsgId;
            var lastContToken;
            var lastEphemMsgId;

            function resetDevice() {
                device = {};
            }

            function initApiClient() {
                ctnApiClient = undefined;
                var env;

                switch (getFieldValue('selEnvironment')) {
                    case 'development': {
                        env = {
                            defaultDevice: {
                                deviceId: 'drc3XdxNtzoucpw9xiRp',
                                apiAccessSecret: '544bca61a4116e15fd7bb7c3acb2eef2a1466635446e1aa3077b6a4931be51c4c620b87f1f8fdc3c7291f9dc32eb52f3e008755d3ecdaa57052188702c3fee61'
                            },
                            opts: {
                                host: 'localhost:3000',
                                secure: false
                            }
                        };
                    }

                    break;

                    case 'sandbox': {
                        env = {
                            defaultDevice: {
                                deviceId: 'dL8zaQDcyNvxRW3FqsJd',
                                apiAccessSecret: '2e080fe06bd9d6403639d8e7c8d4b518949fdbf1e76a651e29706135a98c73dc815ee7647f7cb9b5ae19b04010b32718f1b85aacdd281677aca7499eeb3275f7'
                            },
                            opts: {
                                environment: 'sandbox'
                            }
                        };
                    }

                    break;

                    default:
                        throw new Error('Invalid Catenis environment');
                }

                if (!device.deviceId) {
                    device = env.defaultDevice;
                    resetDeviceIdField();
                }

                ctnApiClient = new CatenisApiClient(device.deviceId, device.apiAccessSecret, env.opts);

                fillPermEventNames(['selSetPermRightsEventName', 'selRetrvPermRightsEventName', 'selCheckEffectivePermRight']);
                fillNotifyEventNames(['selOpenNotifyEventName', 'selCloseNotifyEventName']);
            }

            function logMessage(message, sendInChunks, isFinal, continuationToken, encoding, encrypt, storage, async) {
                if (sendInChunks) {
                    message = {
                        data: message,
                        isFinal: isFinal,
                        continuationToken: continuationToken
                    }
                }

                ctnApiClient.logMessage(message, {
                    encoding: encoding,
                    encrypt: encrypt,
                    storage: storage,
                    async: async
                }, processMessageResult);
            }

            function sendMessage(message, sendInChunks, isFinal, continuationToken, targetDeviceId, isProdUniqueId, encoding, encrypt, storage, readConfirmation, async) {
                if (sendInChunks) {
                    message = {
                        data: message,
                        isFinal: isFinal,
                        continuationToken: continuationToken
                    }
                }

                ctnApiClient.sendMessage(message, {
                    id: targetDeviceId,
                    isProdUniqueId: isProdUniqueId
                }, {
                    readConfirmation: readConfirmation,
                    encoding: encoding,
                    encrypt: encrypt,
                    storage: storage,
                    async: async
                }, processMessageResult);
            }

            function readMessage(messageId, encoding, continuationToken, dataChunkSize, async) {
                var options = {
                    encoding: encoding,
                    continuationToken: continuationToken,
                    dataChunkSize: dataChunkSize,
                    async: async
                };
                ctnApiClient.readMessage(messageId, options, processMessageResult);
            }

            function retrieveMessageContainer(messageId) {
                ctnApiClient.retrieveMessageContainer(messageId, processResult);
            }

            function retrieveMessageProgress(ephemMessageId) {
                ctnApiClient.retrieveMessageProgress(ephemMessageId, processMessageResult);
            }

            function listMessages(action, direction, fromDeviceIds, toDeviceIds, fromDeviceProdUniqueIds, toDeviceProdUniqueIds, readState, startDate, endDate, limit, skip) {
                var options = {
                    action: action,
                    direction: direction,
                    readState: readState,
                    startDate: startDate,
                    endDate: endDate
                };
                var fromDevices = [];
                if (fromDeviceIds) {
                    fromDeviceIds.split(',').forEach(function (deviceId) {
                        fromDevices.push({id: deviceId});
                    });
                }
                if (fromDeviceProdUniqueIds) {
                    fromDeviceProdUniqueIds.split(',').forEach(function (prodUniqueId) {
                        fromDevices.push({
                            id: prodUniqueId,
                            isProdUniqueId: true
                        });
                    });
                }
                if (fromDevices.length > 0) {
                    options.fromDevices = fromDevices;
                }
                var toDevices = [];
                if (toDeviceIds) {
                    toDeviceIds.split(',').forEach(function (deviceId) {
                        toDevices.push({id: deviceId});
                    });
                }
                if (toDeviceProdUniqueIds) {
                    toDeviceProdUniqueIds.split(',').forEach(function (prodUniqueId) {
                        toDevices.push({
                            id: prodUniqueId,
                            isProdUniqueId: true
                        });
                    });
                }
                if (toDevices.length > 0) {
                    options.toDevices = toDevices;
                }
                ctnApiClient.listMessages(options, limit, skip, processResult);
            }

            function listPermissionEvents(cb) {
                ctnApiClient.listPermissionEvents(typeof cb === 'function' ? cb : processResult);
            }

            function retrievePermissionRights(eventName) {
                ctnApiClient.retrievePermissionRights(eventName, processResult);
            }

            function setPermissionRights(eventName, rights) {
                ctnApiClient.setPermissionRights(eventName, rights, processResult);
            }

            function checkEffectivePermissionRight(eventName, deviceId, isProdUniqueId) {
                ctnApiClient.checkEffectivePermissionRight(eventName, deviceId, isProdUniqueId, processResult);
            }

            function listNotificationEvents(cb) {
                ctnApiClient.listNotificationEvents(typeof cb === 'function' ? cb : processResult);
            }

            function retrieveDeviceIdentificationInfo(deviceId, isProdUniqueId) {
                ctnApiClient.retrieveDeviceIdentificationInfo(deviceId, isProdUniqueId, processResult);
            }

            function issueAsset(name, description, canReissue, decimalPlaces, amount, holdingDeviceId, isProdUniqueId) {
                var holdingDevice;

                if (holdingDeviceId) {
                    holdingDevice = {
                        id: holdingDeviceId
                    };

                    if (isProdUniqueId) {
                        holdingDevice.isProdUniqueId = isProdUniqueId;
                    }
                }

                ctnApiClient.issueAsset({
                    name: name,
                    description: description,
                    canReissue: canReissue,
                    decimalPlaces: decimalPlaces
                }, amount, holdingDevice, processResult);
            }

            function reissueAsset(assetId, amount, holdingDeviceId, isProdUniqueId) {
                var holdingDevice;

                if (holdingDeviceId) {
                    holdingDevice = {
                        id: holdingDeviceId
                    };

                    if (isProdUniqueId) {
                        holdingDevice.isProdUniqueId = isProdUniqueId;
                    }
                }

                ctnApiClient.reissueAsset(assetId, amount, holdingDevice, processResult);
            }
            
            function transferAsset(assetId, amount, receivingDeviceId, isProdUniqueId) {
                var receivingDevice;

                if (receivingDeviceId) {
                    receivingDevice = {
                        id: receivingDeviceId
                    };

                    if (isProdUniqueId) {
                        receivingDevice.isProdUniqueId = isProdUniqueId;
                    }
                }

                ctnApiClient.transferAsset(assetId, amount, receivingDevice, processResult);
            }

            function retrieveAssetInfo(assetId) {
                ctnApiClient.retrieveAssetInfo(assetId, processResult);
            }

            function getAssetBalance(assetId) {
                ctnApiClient.getAssetBalance(assetId, processResult);
            }

            function listOwnedAssets(limit, skip) {
                ctnApiClient.listOwnedAssets(limit, skip, processResult);
            }

            function listIssuedAssets(limit, skip) {
                ctnApiClient.listIssuedAssets(limit, skip, processResult);
            }

            function retrieveAssetIssuanceHistory(assetId, startDate, endDate, limit, skip) {
                ctnApiClient.retrieveAssetIssuanceHistory(assetId, startDate, endDate, limit, skip, processResult);
            }

            function listAssetHolders(assetId, limit, skip) {
                ctnApiClient.listAssetHolders(assetId, limit, skip, processResult);
            }

            function processMessageResult(err, data, parseResultOnly) {
                if (!err && typeof data === 'object' && data !== null) {
                    if (typeof data.messageId === 'string') {
                        lastMsgId = data.messageId;
                    }
                    else if (typeof data.continuationToken === 'string') {
                        lastContToken = data.continuationToken;
                    }
                    else if (typeof data.provisionalMessageId === 'string') {
                        lastEphemMsgId = data.provisionalMessageId;
                    }
                    else if (typeof data.cachedMessageId === 'string') {
                        lastEphemMsgId = data.cachedMessageId;
                    }
                    if (typeof data.result === 'object' && data.result !== null) {
                        if (typeof data.result.continuationToken === 'string') {
                            lastContToken = data.result.continuationToken;
                        }
                        else if (typeof data.result.messageId === 'string') {
                            lastMsgId = data.result.messageId;
                        }
                    }
                }

                if (!parseResultOnly) {
                    processResult(err, data);
                }
            }

            function processResult(err, data) {
                //showArgs.bind(undefined, 'processResult')(arguments);
                if (err) {
                    showApiResult(err, true);
                }
                else {
                    showApiResult(data);
                }
            }

            function showApiResult(data, isError) {
                document.getElementById('pApiResult').innerHTML = isError ? '<span style="color: red;">ERROR:</span>' + (typeof data === 'object' && data !== null && data.message ? '<br>' + data.message: '<pre>' + JSON.stringify(data, null, '  ') + '</pre>') : '<pre>' + JSON.stringify(data, null, '  ') + '</pre>';
            }

            function clearApiResult() {
                document.getElementById('pApiResult').innerHTML = '';
            }

            function getFieldValue(ctrlId, trim) {
                var value = document.getElementById(ctrlId).value;
                return trim ? value.trim() : value;
            }

            function parseNumber(val) {
                return val ? parseInt(val) : val;
            }

            function parseAmount(val) {
                return val ? parseFloat(val) : val;
            }

            function isFieldChecked(ctrlId) {
                return document.getElementById(ctrlId).checked;
            }

            function requireField(ctrlId, fieldName, startsWithVowel, trim) {
                var fieldCtrl = document.getElementById(ctrlId);
                var fieldValue = trim ? fieldCtrl.value.trim() : fieldCtrl.value;

                if (fieldValue && fieldValue.length > 0) {
                    return true;
                }
                else {
                    alert('Please enter ' + (startsWithVowel ? 'an ' : 'a ') + fieldName);
                    fieldCtrl.focus();
                    return false;
                }
            }

            function checkListMessagesDateFields() {
                if (checkDateField('idtStartDate')) {
                    return checkDateField('idtEndDate');
                }

                return false;
            }

            function checkAssetIssuanceHistoryDateFields() {
                if (checkDateField('idtStartDate2')) {
                    return checkDateField('idtEndDate2');
                }

                return false;
            }

            function checkDateField(ctrlId) {
                var startDate = document.getElementById(ctrlId);

                if (startDate && checkUndefined(startDate.value.trim())) {
                    if (!moment(startDate.value.trim()).isValid()) {
                        alert('Invalid date and time. Please enter date and time in a ISO-8601 format like \'YYYY-MM-DD HH:mm:ss\'');
                        startDate.focus();
                        return false;
                    }
                }

                return true;
            }

            function formatDate(value) {
                var mt = moment(value.trim());

                if (mt.isValid()) {
                    return mt.utc().format('YYYYMMDDTHHmmss[Z]');
                }

                return undefined;
            }

            function checkNumberField(ctrlId) {
                var fieldCtrl = document.getElementById(ctrlId);

                if (fieldCtrl) {
                    var val = parseInt(fieldCtrl.value);

                    if (isNaN(val)) {
                        alert('Invalid number');
                        fieldCtrl.focus();
                        return false;
                    }

                    return true;
                }

                return false;
            }

            function checkAmountField(ctrlId) {
                var fieldCtrl = document.getElementById(ctrlId);

                if (fieldCtrl) {
                    var val = parseFloat(fieldCtrl.value);

                    if (isNaN(val)) {
                        alert('Invalid amount');
                        fieldCtrl.focus();
                        return false;
                    }

                    return true;
                }

                return false;
            }

            function updateDeviceId(ctrl) {
                if (ctrl.value && ctrl.value.length > 0) {
                    var oldDeviceId = device.deviceId;

                    if (oldDeviceId !== ctrl.value) {
                        var newApiAccessSecret;

                        do {
                            newApiAccessSecret = prompt('Please enter API access secret for device');
                        }
                        while (newApiAccessSecret !== null && newApiAccessSecret.length === 0);

                        if (newApiAccessSecret !== null) {
                            device.deviceId = ctrl.value;
                            device.apiAccessSecret = newApiAccessSecret;

                            clearApiResult();
                            initApiClient();
                        }
                        else {
                            resetDeviceIdField();
                        }
                    }
                }
                else {
                    resetDeviceIdField();
                }
            }

            function resetDeviceIdField() {
                document.getElementById('itxDeviceId').value = device.deviceId;
            }

            function fillWithLastMsgId(fieldId) {
                if (lastMsgId) {
                    document.getElementById(fieldId).value = lastMsgId;
                }
            }

            function fillWithLastContToken(fieldId) {
                if (lastContToken) {
                    document.getElementById(fieldId).value = lastContToken;
                }
            }

            function fillWithLastEphemMsgId(fieldId) {
                if (lastEphemMsgId) {
                    document.getElementById(fieldId).value = lastEphemMsgId;
                }
            }

            function checkUndefined(value) {
                return value === undefined || value === null || (typeof value === 'string' && value.length === 0) ? undefined : value;
            }

            function showArgs(label) {
                var argList = 'Source: ' + label;
                argList += '\nthis: ' + this;
                var args = Array.prototype.slice.call(arguments);
                args.shift();
                args.forEach(function (arg, idx) {
                    if (argList.length > 0) {
                        argList += '\n';
                    }
                    argList += 'Arg.#' + (idx + 1) + ': ' + JSON.stringify(arg);
                });
                alert(argList);
            }

            function appendInputText(parentId, maxLength, size, placeholder) {
                var parentElem = document.getElementById(parentId);
                parentElem.appendChild(document.createElement('br'));

                var inputElem = document.createElement('input');
                inputElem.setAttribute('type', 'text');
                inputElem.setAttribute('maxlength', maxLength);
                inputElem.setAttribute('size', size);
                if (placeholder)
                    inputElem.setAttribute('placeholder', placeholder);
                parentElem.appendChild(inputElem);
            }

            function removeLastInputText(parentId) {
                var parentElem = document.getElementById(parentId);
                var inputList = parentElem.getElementsByTagName('input');

                if (inputList.length > 1) {
                    var inputElem = inputList.item(inputList.length - 1);
                    parentElem.removeChild(inputElem.previousSibling);
                    parentElem.removeChild(inputElem);
                }
            }

            function appendDeviceIdInput(parentId, maxLength, size, placeholder) {
                var parentElem = document.getElementById(parentId);
                var divElem = document.createElement('div');
                divElem.setAttribute('style', 'margin-bottom:0.3em')

                var inputElem = document.createElement('input');
                inputElem.setAttribute('type', 'text');
                inputElem.setAttribute('maxlength', maxLength);
                inputElem.setAttribute('size', size);
                if (placeholder)
                    inputElem.setAttribute('placeholder', placeholder);
                divElem.appendChild(inputElem);

                divElem.appendChild(document.createElement('br'));

                var labelElem = document.createElement('label');
                labelElem.innerText = 'product unique ID: ';
                divElem.appendChild(labelElem);

                inputElem = document.createElement('input');
                inputElem.setAttribute('type', 'checkbox');
                divElem.appendChild(inputElem);

                parentElem.appendChild(divElem);
            }

            function removeDeviceIdInput(parentId) {
                var parentElem = document.getElementById(parentId);
                var divList = parentElem.getElementsByTagName('div');

                if (divList.length > 1) {
                    var divElem = divList.item(divList.length - 1);
                    parentElem.removeChild(divElem);
                }
            }

            function checkPermEventNameField(ctrlId) {
                var permEventNameCtrl = document.getElementById(ctrlId);

                if (permEventNameCtrl && checkUndefined(permEventNameCtrl.value) === undefined) {
                    alert('Please select a permission event');
                    permEventNameCtrl.focus();
                    return false;
                }

                return true;
            }

            function checkDeviceIdField(ctrlId, qualifier, startsWithVowel, trim) {
                var devIdCtrl = document.getElementById(ctrlId);

                if (devIdCtrl && checkUndefined(getFieldValue(ctrlId, trim)) === undefined) {
                    alert('Please enter ' + (qualifier && startsWithVowel ? 'an ' : 'a ') + (qualifier ? qualifier + ' ' : '') + 'device ID');
                    devIdCtrl.focus();
                    return false;
                }

                return true;
            }

            function fillPermEventNames(selCtrlIds) {
                listPermissionEvents(function (err, data) {
                    if (err) {
                        console.debug('Error calling List Permission Events Catenis API method', err);
                    }
                    else {
                        selCtrlIds = Array.isArray(selCtrlIds) ? selCtrlIds : [selCtrlIds];

                        selCtrlIds.forEach(function (selCtrlId) {
                            emptySelCtrl(selCtrlId);
                            var selCtrl = document.getElementById(selCtrlId);

                            selCtrl.appendChild(document.createElement('option'));

                            if (selCtrl) {
                                Object.keys(data).forEach(function (eventName) {
                                    var optElem = document.createElement('option');
                                    optElem.setAttribute('value', eventName);
                                    optElem.innerText = eventName + ' - ' + data[eventName];
                                    selCtrl.appendChild(optElem);
                                });
                            }

                            selCtrl.selectedIndex = 0;
                        });
                    }
                });
            }

            function emptySelCtrl(selCtrlId) {
                var selCtrl = document.getElementById(selCtrlId);

                if (selCtrl) {
                    var numOptions = selCtrl.options.length;

                    if (numOptions > 0) {
                        for (var idx = numOptions - 1; idx >= 0; idx--) {
                            selCtrl.remove(selCtrl[idx]);
                        }
                    }
                }
            }

            function getPermRightsToSet() {
                var rights = {};

                var sysRight = checkUndefined(getFieldValue('selSysRight'));
                if (sysRight)
                    rights.system = sysRight;

                var allowCtnNodeIndices = [];
                (function (inputElems) {
                    for (var idx = 0; idx < inputElems.length; idx++) {
                        var value = checkUndefined(inputElems[idx].value.trim());
                        if (value)
                            allowCtnNodeIndices.push(value);
                    }
                })(document.getElementById('divCtnNodeAllow').getElementsByTagName('input'));

                var denyCtnNodeIndices = [];
                (function (inputElems) {
                    for (var idx = 0; idx < inputElems.length; idx++) {
                        var value = checkUndefined(inputElems[idx].value.trim());
                        if (value)
                            denyCtnNodeIndices.push(value);
                    }
                })(document.getElementById('divCtnNodeDeny').getElementsByTagName('input'));

                var noneCtnNodeIndices = [];
                (function (inputElems) {
                    for (var idx = 0; idx < inputElems.length; idx++) {
                        var value = checkUndefined(inputElems[idx].value.trim());
                        if (value)
                            noneCtnNodeIndices.push(value);
                    }
                })(document.getElementById('divCtnNodeNone').getElementsByTagName('input'));

                if (allowCtnNodeIndices.length > 0 || denyCtnNodeIndices.length > 0 || noneCtnNodeIndices.length > 0) {
                    rights.catenisNode = {};

                    if (allowCtnNodeIndices.length > 0)
                        rights.catenisNode.allow = allowCtnNodeIndices.length > 1 ? allowCtnNodeIndices : allowCtnNodeIndices[0];

                    if (denyCtnNodeIndices.length > 0)
                        rights.catenisNode.deny = denyCtnNodeIndices.length > 1 ? denyCtnNodeIndices : denyCtnNodeIndices[0];

                    if (noneCtnNodeIndices.length > 0)
                        rights.catenisNode.none = noneCtnNodeIndices.length > 1 ? noneCtnNodeIndices : noneCtnNodeIndices[0];
                }

                var allowClientIds = [];
                (function (inputElems) {
                    for (var idx = 0; idx < inputElems.length; idx++) {
                        var value = checkUndefined(inputElems[idx].value.trim());
                        if (value)
                            allowClientIds.push(value);
                    }
                })(document.getElementById('divClientAllow').getElementsByTagName('input'));

                var denyClientIds = [];
                (function (inputElems) {
                    for (var idx = 0; idx < inputElems.length; idx++) {
                        var value = checkUndefined(inputElems[idx].value.trim());
                        if (value)
                            denyClientIds.push(value);
                    }
                })(document.getElementById('divClientDeny').getElementsByTagName('input'));

                var noneClientIds = [];
                (function (inputElems) {
                    for (var idx = 0; idx < inputElems.length; idx++) {
                        var value = checkUndefined(inputElems[idx].value.trim());
                        if (value)
                            noneClientIds.push(value);
                    }
                })(document.getElementById('divClientNone').getElementsByTagName('input'));

                if (allowClientIds.length > 0 || denyClientIds.length > 0 || noneClientIds.length > 0) {
                    rights.client = {};

                    if (allowClientIds.length > 0)
                        rights.client.allow = allowClientIds.length > 1 ? allowClientIds : allowClientIds[0];

                    if (denyClientIds.length > 0)
                        rights.client.deny = denyClientIds.length > 1 ? denyClientIds : denyClientIds[0];

                    if (noneClientIds.length > 0)
                        rights.client.none = noneClientIds.length > 1 ? noneClientIds : noneClientIds[0];
                }

                var allowDeviceIds = [];
                (function (divElems) {
                    for (var idx = 0; idx < divElems.length; idx++) {
                        var deviceId = {};

                        (function (inputElems) {
                            for (var idx = 0; idx < inputElems.length; idx++) {
                                if (idx === 0) {
                                    var value = checkUndefined(inputElems[idx].value.trim());
                                    if (value)
                                        deviceId.id = value;
                                }
                                else {
                                    if (inputElems[idx].checked)
                                        deviceId.prodUniqueId = true;
                                }
                            }
                        })(divElems[idx].getElementsByTagName('input'));

                        if (deviceId.id)
                            allowDeviceIds.push(deviceId);
                    }
                })(document.getElementById('divDeviceAllow').getElementsByTagName('div'));

                var denyDeviceIds = [];
                (function (divElems) {
                    for (var idx = 0; idx < divElems.length; idx++) {
                        var deviceId = {};

                        (function (inputElems) {
                            for (var idx = 0; idx < inputElems.length; idx++) {
                                if (idx === 0) {
                                    var value = checkUndefined(inputElems[idx].value.trim());
                                    if (value)
                                        deviceId.id = value;
                                }
                                else {
                                    if (inputElems[idx].checked)
                                        deviceId.prodUniqueId = true;
                                }
                            }
                        })(divElems[idx].getElementsByTagName('input'));

                        if (deviceId.id)
                            denyDeviceIds.push(deviceId);
                    }
                })(document.getElementById('divDeviceDeny').getElementsByTagName('div'));

                var noneDeviceIds = [];
                (function (divElems) {
                    for (var idx = 0; idx < divElems.length; idx++) {
                        var deviceId = {};

                        (function (inputElems) {
                            for (var idx = 0; idx < inputElems.length; idx++) {
                                if (idx === 0) {
                                    var value = checkUndefined(inputElems[idx].value.trim());
                                    if (value)
                                        deviceId.id = value;
                                }
                                else {
                                    if (inputElems[idx].checked)
                                        deviceId.prodUniqueId = true;
                                }
                            }
                        })(divElems[idx].getElementsByTagName('input'));

                        if (deviceId.id)
                            noneDeviceIds.push(deviceId);
                    }
                })(document.getElementById('divDeviceNone').getElementsByTagName('div'));

                if (allowDeviceIds.length > 0 || denyDeviceIds.length > 0 || noneDeviceIds.length > 0) {
                    rights.device = {};

                    if (allowDeviceIds.length > 0)
                        rights.device.allow = allowDeviceIds.length > 1 ? allowDeviceIds : allowDeviceIds[0];

                    if (denyDeviceIds.length > 0)
                        rights.device.deny = denyDeviceIds.length > 1 ? denyDeviceIds : denyDeviceIds[0];

                    if (noneDeviceIds.length > 0)
                        rights.device.none = noneDeviceIds.length > 1 ? noneDeviceIds : noneDeviceIds[0];
                }

                return rights;
            }

            function checkNotifyEventNameField(ctrlId) {
                var ntfyEventName = document.getElementById(ctrlId);

                if (ntfyEventName && checkUndefined(ntfyEventName.value) === undefined) {
                    alert('Please select a notification event');
                    ntfyEventName.focus();
                    return false;
                }

                return true;
            }

            function fillNotifyEventNames(selCtrlIds) {
                listNotificationEvents(function (err, data) {
                    if (err) {
                        console.debug('Error calling List Notification Events Catenis API method', err);
                    }
                    else {
                        selCtrlIds = Array.isArray(selCtrlIds) ? selCtrlIds : [selCtrlIds];

                        selCtrlIds.forEach(function (selCtrlId) {
                            emptySelCtrl(selCtrlId);
                            var selCtrl = document.getElementById(selCtrlId);

                            selCtrl.appendChild(document.createElement('option'));

                            if (selCtrl) {
                                Object.keys(data).forEach(function (eventName) {
                                    var optElem = document.createElement('option');
                                    optElem.setAttribute('value', eventName);
                                    optElem.innerText = eventName + ' - ' + data[eventName];
                                    selCtrl.appendChild(optElem);
                                });
                            }
                        });
                    }
                });
            }

            var wsNtfyChannels = {};

            function showWSActiviy(eventName, data) {
                var pElem = document.createElement('p');
                pElem.style.wordWrap = "break-word";
                pElem.innerHTML = '[' + eventName + '] - ' + data;
                document.getElementById('pNtfyChannelActivity').appendChild(pElem);
            }

            function clearWSActiviy() {
                document.getElementById('pNtfyChannelActivity').innerHTML = '';
            }

            function openWsNtfyChannel(eventName) {
                if (!(eventName in wsNtfyChannels)) {
                    var wsNtfyChannel = ctnApiClient.createWsNotifyChannel(eventName);

                    wsNtfyChannel.addListener('error', function (error) {
                        showWSActiviy(this.eventName, '<span style="color: red;">ERROR:</span><pre>' + JSON.stringify(error) + '</pre>');
                    });

                    wsNtfyChannel.addListener('close', function (code, reason) {
                        showWSActiviy(this.eventName, 'DISCONNECTED - [' + code + ']' + (reason ? ' - ' + reason : ''));
                        delete wsNtfyChannels[eventName];
                    });

                    wsNtfyChannel.addListener('open', function () {
                        // Notification channel successfully open and ready to send notifications
                        showWSActiviy(this.eventName, 'NOTIFICATION CHANNEL OPEN');
                    });

                    wsNtfyChannel.addListener('notify', function (data) {
                        if (this.eventName === 'final-msg-progress') {
                            processMessageResult(null, data, true);
                        }

                        showWSActiviy(this.eventName, '<span style="color: blue;">RECEIVED DATA:</span><pre>' + JSON.stringify(data, null, '  ') + '</pre>');
                    });

                    wsNtfyChannel.open(function (err) {
                        if (err) {
                            showWSActiviy(this.eventName, '<span style="color: red;">ERROR:</span><pre>' + error + '</pre>');
                        }
                        else {
                            // WebSocket connected
                            showWSActiviy(this.eventName, 'CONNECTED');
                        }
                    });

                    wsNtfyChannels[eventName] = wsNtfyChannel;
                }
            }

            function closeWsNtfyChannel(eventName) {
                if (eventName in wsNtfyChannels) {
                    wsNtfyChannels[eventName].close();
                }
            }

            function selectPanel(selectedPanelId) {
                var panelIds = [
                    'divMessage',
                    'divPermNotif',
                    'divAsset'
                ];

                panelIds.forEach(function (id) {
                    document.getElementById(id).style.display = id === selectedPanelId ? 'block' : 'none';
                });
            }

            function setAssetIssueFields(reissue) {
                var reissueRowIds = [
                    'trAssetId'
                ];
                var issueRowIds = [
                    'trAssetName',
                    'trAssetDescription',
                    'trCanReissue',
                    'trDecimalPlaces'
                ];

                function displayElements(ids, show) {
                    ids.forEach(function (id) {
                        document.getElementById(id).style.display = show ? 'table-row' : 'none';
                    });
                }

                if (reissue) {
                    displayElements(reissueRowIds, true);
                    displayElements(issueRowIds, false);
                }
                else {
                    displayElements(reissueRowIds, false);
                    displayElements(issueRowIds, true);
                }
            }
        </script>
    </head>
    <body>
        <div id="divEnvironment">
            <label for="selEnvironment">Environment: </label><select id="selEnvironment" onchange="clearApiResult(); resetDevice(); initApiClient()">
                <option value="development" selected>Development</option>
                <option value="sandbox">Sandbox</option>
                <option value="prod">Production</option>
            </select>
            <br/><label for="itxDeviceId">Device ID: </label><input id="itxDeviceId" maxlength="20" size="30" onchange="updateDeviceId(this)"/>
            <script language="JavaScript">resetDeviceIdField()</script>
        </div>
        <div style="margin-top:1em">
            <a href="javascript:selectPanel('divMessage')">Messages</a>&nbsp;&nbsp;&nbsp;<a href="javascript:selectPanel('divAsset')">Assets</a>&nbsp;<a href="javascript:selectPanel('divPermNotif')">Permission & Notification</a>&nbsp;&nbsp;&nbsp;<a href="javascript:selectPanel(null)">None</a>
        </div>
        <div id="divMessage" style="margin-top:1em; display:none">
            <table>
                <tr>
                    <td valign="top" align="right">
                        <label for="itxMessage">Message: </label>
                    </td>
                    <td>
                        <textarea id="itxMessage" rows="5" cols="80"></textarea>
                        <div style="margin-top:0; margin-bottom:0.5em">
                            <label for="cbxMsgChunks">Break in chunks: </label><input id="cbxMsgChunks" type="checkbox" onclick="document.getElementById('divMsgChunks').style.display=this.checked?'block':'none'" />
                            <div id="divMsgChunks" style="display:none; margin-left:2em; margin-bottom:0">
                                <label for="cbxIsFinal">Is final: </label><input id="cbxIsFinal" type="checkbox" checked />
                                <br/><label for="itxContToken">Continuation token: </label><input id="itxContToken" type="text" maxlength="20" size="20"/>&nbsp;<a href="javascript:fillWithLastContToken('itxContToken')">Fill with last cont. token</a>
                            </div>
                        </div>
                        <label for="selMsgEncoding">encoding: </label><select id="selMsgEncoding">
                            <option value="utf8" selected>UTF-8</option>
                            <option value="base64">Base-64</option>
                            <option value="hex">Hex</option>
                        </select>
                        <br/><label for="cbxMsgEncrypt">encrypt: </label><input id="cbxMsgEncrypt" type="checkbox" checked />
                        <br/><label for="selMsgStorage">storage: </label><select id="selMsgStorage">
                            <option value="auto" selected>Auto</option>
                            <option value="embedded">Embedded</option>
                            <option value="external">External</option>
                        </select>
                        <div style="margin-top:0.5em">
                            <label for="cbxMsgAsync">Asynchronous processing: </label><input id="cbxMsgAsync" type="checkbox" />
                        </div>
                        <button id="btnLogMessage" style="margin-top:10px" onclick="clearApiResult(); if(requireField('itxMessage','message')){logMessage(getFieldValue('itxMessage'), isFieldChecked('cbxMsgChunks'), isFieldChecked('cbxIsFinal'), checkUndefined(getFieldValue('itxContToken',true)), getFieldValue('selMsgEncoding'), isFieldChecked('cbxMsgEncrypt'), getFieldValue('selMsgStorage'), isFieldChecked('cbxMsgAsync'))}else{return false}">Log Message</button>
                        <div style="margin-top:1em">
                            <table>
                                <tr>
                                    <td valign="top">
                                        <label for="itxTrgtDeviceId">Target device ID: </label>
                                    </td>
                                    <td>
                                        <input id="itxTrgtDeviceId" style="margin-bottom:0.5em" type="text" maxlength="40" size="40"/>
                                        <br/><label for="cbxProdUniqId">product unique ID: </label><input id="cbxProdUniqId" type="checkbox"/>
                                        <br/><label for="cbxReadConfirm" style="margin-top:13px">read confirmation: </label><input id="cbxReadConfirm" type="checkbox" style="margin-top:13px" />
                                        <br/><button id="btnSendMessage" style="margin-top:8px" onclick="clearApiResult(); if(requireField('itxMessage','message') && checkDeviceIdField('itxTrgtDeviceId','target')){sendMessage(getFieldValue('itxMessage'), isFieldChecked('cbxMsgChunks'), isFieldChecked('cbxIsFinal'), checkUndefined(getFieldValue('itxContToken',true)), getFieldValue('itxTrgtDeviceId'), isFieldChecked('cbxProdUniqId'), getFieldValue('selMsgEncoding'), isFieldChecked('cbxMsgEncrypt'), getFieldValue('selMsgStorage'), isFieldChecked('cbxReadConfirm'), isFieldChecked('cbxMsgAsync'))}else{return false}">Send Message</button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-top:1.25em">
                        <label for="itxMsgId">Message ID: </label>
                    </td>
                    <td style="padding-top:1em">
                        <input id="itxMsgId" style="margin-bottom:0.5em" type="text" maxlength="20" size="20"/>&nbsp;<a href="javascript:fillWithLastMsgId('itxMsgId')">Fill with last message ID</a>
                        <br/><button id="btnRetrieveMessageContainer" style="margin-top:5px;margin-bottom:10px" onclick="clearApiResult(); if(requireField('itxMsgId','message ID')){retrieveMessageContainer(getFieldValue('itxMsgId'))}else{return false}">Retrieve Message Container</button>
                        <br/><label for="selRdMsgEncoding">encoding: </label><select id="selRdMsgEncoding">
                            <option value="utf8" selected>UTF-8</option>
                            <option value="base64">Base-64</option>
                            <option value="hex">Hex</option>
                        </select>
                        <br/><label for="itxReadContToken">Continuation token: </label><input id="itxReadContToken" type="text" maxlength="20" size="20"/>&nbsp;<a href="javascript:fillWithLastContToken('itxReadContToken')">Fill with last cont. token</a>
                        <div style="margin-top:0.5em">
                            <label for="cbxReadMsgChunks">Read in chunks: </label><input id="cbxReadMsgChunks" type="checkbox" onclick="document.getElementById('divReadMsgChunks').style.display=this.checked?'block':'none'" />
                            <div id="divReadMsgChunks" style="display:none; margin-left:2em; margin-bottom:0" onclick="if(!this.checked){document.getElementById('itxDataChunkSize').value=''}">
                                <label for="itxDataChunkSize">Chunk size: </label><input id="itxDataChunkSize" type="text" maxlength="11" size="11"/>
                            </div>
                        </div>
                        <div style="margin-top:0.5em">
                            <label for="cbxReadMsgAsync">Asynchronous processing: </label><input id="cbxReadMsgAsync" type="checkbox" />
                        </div>
                        <button id="btnReadMessage" style="margin-top:10px" onclick="clearApiResult(); if(requireField('itxMsgId','message ID') && (!isFieldChecked('cbxReadMsgChunks') || requireField('itxDataChunkSize','chunk size',false,true)) && (checkUndefined(getFieldValue('itxDataChunkSize',true))===undefined || checkNumberField('itxDataChunkSize'))){readMessage(getFieldValue('itxMsgId'), getFieldValue('selRdMsgEncoding'), checkUndefined(getFieldValue('itxReadContToken',true)), checkUndefined(getFieldValue('itxDataChunkSize',true)), isFieldChecked('cbxReadMsgAsync'))}else{return false}">Read Message</button>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-top:1.25em">
                        <label for="itxEphemMsgId">Ephemeral message ID: </label>
                    </td>
                    <td style="padding-top:1em">
                        <input id="itxEphemMsgId" style="margin-bottom:0.5em" type="text" maxlength="20" size="20"/>&nbsp;<a href="javascript:fillWithLastEphemMsgId('itxEphemMsgId')">Fill with last ephem. message ID</a>
                        <br/><button id="btnRetrieveMessageProgress" style="margin-top:5px;margin-bottom:10px" onclick="clearApiResult(); if(requireField('itxEphemMsgId','ephemeral message ID')){retrieveMessageProgress(getFieldValue('itxEphemMsgId'))}else{return false}">Retrieve Message Progress</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        List messages:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="selMsgAction">action: </label>
                    </td>
                    <td>
                        <select id="selMsgAction">
                            <option ></option>
                            <option value="log">Log</option>
                            <option value="send">Send</option>
                            <option value="any">Any</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="selMsgDirection">direction: </label>
                    </td>
                    <td>
                        <select id="selMsgDirection">
                            <option ></option>
                            <option value="inbound">Inbound</option>
                            <option value="outbound">Outbound</option>
                            <option value="any">Any</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxFromDeviceIds">from devices: <br>(device IDs)</label>
                    </td>
                    <td>
                        <textarea id="itxFromDeviceIds" rows="3" cols="80"></textarea>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxToDeviceIds">to devices: <br>(device IDs)</label>
                    </td>
                    <td>
                        <textarea id="itxToDeviceIds" rows="3" cols="80"></textarea>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxFromDevProdUniqueIds">from devices: <br>(prod. unique IDs)</label>
                    </td>
                    <td>
                        <textarea id="itxFromDevProdUniqueIds" rows="3" cols="80"></textarea>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxToDevProdUniqueIds">to devices: <br>(prod. unique IDs)</label>
                    </td>
                    <td>
                        <textarea id="itxToDevProdUniqueIds" rows="3" cols="80"></textarea>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="selReadState">read state: </label>
                    </td>
                    <td>
                        <select id="selReadState">
                            <option ></option>
                            <option value="unread">Unread</option>
                            <option value="read">Read</option>
                            <option value="any">Any</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="idtStartDate">start date: </label>
                    </td>
                    <td>
                        <!--input id="idtStartDate" type="datetime-local"/-->
                        <input id="idtStartDate" placeholder="YYYY-MM-dd HH:mm:ss" type="text" maxlength="25"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="idtEndDate">end date: </label>
                    </td>
                    <td>
                        <input id="idtEndDate" placeholder="YYYY-MM-dd HH:mm:ss" type="text" maxlength="25"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxMsgLimit">max. returned messages: </label>
                    </td>
                    <td>
                        <input id="itxMsgLimit" type="text" maxlength="3" size="3"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxMsgSkip">messages to skip: </label>
                    </td>
                    <td>
                        <input id="itxMsgSkip" type="text" maxlength="10" size="10"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnListMessages" style="margin-top:10px" onclick="clearApiResult(); if(checkListMessagesDateFields()){listMessages(checkUndefined(getFieldValue('selMsgAction')),checkUndefined(getFieldValue('selMsgDirection')),checkUndefined(getFieldValue('itxFromDeviceIds',true)),checkUndefined(getFieldValue('itxToDeviceIds',true)),checkUndefined(getFieldValue('itxFromDevProdUniqueIds',true)),checkUndefined(getFieldValue('itxToDevProdUniqueIds',true)),checkUndefined(getFieldValue('selReadState')),formatDate(getFieldValue('idtStartDate')),formatDate(getFieldValue('idtEndDate')),parseNumber(checkUndefined(getFieldValue('itxMsgLimit'))),parseNumber(checkUndefined(getFieldValue('itxMsgSkip'))))}else{return false}">List Messages</button>
                    </td>
                </tr>
           </table>
        </div>
        <div id="divPermNotif" style="margin-top:1em; display:none">
            <table>
                <tr>
                    <td colspan="2">
                        Retrieve Device Identification Info:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right">
                        <label for="itxOtherDeviceId">Device ID: </label>
                    </td>
                    <td>
                        <input id="itxOtherDeviceId" style="margin-bottom:0.5em" type="text" maxlength="40" size="40"/>
                        <br/><label for="cbxOtherDeviceProdUniqId">product unique ID: </label><input id="cbxOtherDeviceProdUniqId" type="checkbox"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnRetrvDevIdentityInfo" style="margin-top:10px" onclick="clearApiResult();if(checkDeviceIdField('itxOtherDeviceId')){retrieveDeviceIdentificationInfo(getFieldValue('itxOtherDeviceId',true),isFieldChecked('cbxOtherDeviceProdUniqId').toString())}else{return false}">Retrieve Device Info</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        Retrieve permission rights:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right">
                        <label for="selRetrvPermRightsEventName">Permission event: </label>
                    </td>
                    <td>
                        <select id="selRetrvPermRightsEventName">
                            <option ></option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnRetrvPermissionRights" style="margin-top:10px" onclick="clearApiResult();if(checkPermEventNameField('selRetrvPermRightsEventName')){retrievePermissionRights(getFieldValue('selRetrvPermRightsEventName'))}else{return false}">Retrieve Rights</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        Set permission rights:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-right:1em">
                        <label for="selSetPermRightsEventName">Permission event: </label>
                    </td>
                    <td>
                        <select id="selSetPermRightsEventName">
                            <option ></option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-right:1em">
                        <label>Rights: </label>
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-right:0.5em">
                        <label for="selSysRight">System: </label>
                    </td>
                    <td>
                        <select id="selSysRight">
                            <option ></option>
                            <option value="allow">Allow</option>
                            <option value="deny">Deny</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-right:0.5em">
                        <label>Catenis node: </label>
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td valign="top" align="right">
                        <label for="divCtnNodeAllow">allow: </label>
                    </td>
                    <td>
                        <div id="divCtnNodeAllow">
                            <input type="text" maxlength="4" size="10" placeholder="None index" />
                        </div>
                        <a href="javascript:appendInputText('divCtnNodeAllow', '4', '10', 'None index')">Add</a>&nbsp;
                        <a href="javascript:removeLastInputText('divCtnNodeAllow')">Remove</a>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-top:0.5em">
                        <label for="divCtnNodeDeny">deny: </label>
                    </td>
                    <td style="padding-top:0.5em">
                        <div id="divCtnNodeDeny">
                            <input type="text" maxlength="4" size="10" placeholder="None index" />
                        </div>
                        <a href="javascript:appendInputText('divCtnNodeDeny', '4', '10', 'None index')">Add</a>&nbsp;
                        <a href="javascript:removeLastInputText('divCtnNodeDeny')">Remove</a>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-top:0.5em">
                        <label for="divCtnNodeNone">none: </label>
                    </td>
                    <td style="padding-top:0.5em">
                        <div id="divCtnNodeNone">
                            <input type="text" maxlength="4" size="10" placeholder="None index" />
                        </div>
                        <a href="javascript:appendInputText('divCtnNodeNone', '4', '10', 'None index')">Add</a>&nbsp;
                        <a href="javascript:removeLastInputText('divCtnNodeNone')">Remove</a>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-right:0.5em">
                        <label>Client: </label>
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td valign="top" align="right">
                        <label for="divClientAllow">allow: </label>
                    </td>
                    <td>
                        <div id="divClientAllow">
                            <input type="text" maxlength="20" size="30" placeholder="Client ID" />
                        </div>
                        <a href="javascript:appendInputText('divClientAllow', '20', '30', 'Client ID')">Add</a>&nbsp;
                        <a href="javascript:removeLastInputText('divClientAllow')">Remove</a>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-top:0.5em">
                        <label for="divClientDeny">deny: </label>
                    </td>
                    <td style="padding-top:0.5em">
                        <div id="divClientDeny">
                            <input type="text" maxlength="20" size="30" placeholder="Client ID" />
                        </div>
                        <a href="javascript:appendInputText('divClientDeny', '20', '30', 'Client ID')">Add</a>&nbsp;
                        <a href="javascript:removeLastInputText('divClientDeny')">Remove</a>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-top:0.5em">
                        <label for="divClientNone">none: </label>
                    </td>
                    <td style="padding-top:0.5em">
                        <div id="divClientNone">
                            <input type="text" maxlength="20" size="30" placeholder="Client ID" />
                        </div>
                        <a href="javascript:appendInputText('divClientNone', '20', '30', 'Client ID')">Add</a>&nbsp;
                        <a href="javascript:removeLastInputText('divClientNone')">Remove</a>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-right:0.5em">
                        <label>Device: </label>
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td valign="top" align="right">
                        <label for="divDeviceAllow">allow: </label>
                    </td>
                    <td>
                        <div id="divDeviceAllow">
                            <div style="margin-bottom:0.3em">
                                <input type="text" maxlength="20" size="30" placeholder="Device ID" />
                                <br/><label>product unique ID: </label><input type="checkbox"/>
                            </div>
                        </div>
                        <a href="javascript:appendDeviceIdInput('divDeviceAllow', '20', '30', 'Device ID')">Add</a>&nbsp;
                        <a href="javascript:removeDeviceIdInput('divDeviceAllow')">Remove</a>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-top:0.5em">
                        <label for="divDeviceDeny">deny: </label>
                    </td>
                    <td style="padding-top:0.5em">
                        <div id="divDeviceDeny">
                            <div style="margin-bottom:0.3em">
                                <input type="text" maxlength="20" size="30" placeholder="Device ID" />
                                <br/><label>product unique ID: </label><input type="checkbox"/>
                            </div>
                        </div>
                        <a href="javascript:appendDeviceIdInput('divDeviceDeny', '20', '30', 'Device ID')">Add</a>&nbsp;
                        <a href="javascript:removeDeviceIdInput('divDeviceDeny')">Remove</a>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-top:0.5em">
                        <label for="divDeviceNone">none: </label>
                    </td>
                    <td style="padding-top:0.5em">
                        <div id="divDeviceNone">
                            <div style="margin-bottom:0.3em">
                                <input type="text" maxlength="20" size="30" placeholder="Device ID" />
                                <br/><label>product unique ID: </label><input type="checkbox"/>
                            </div>
                        </div>
                        <a href="javascript:appendDeviceIdInput('divDeviceNone', '20', '30', 'Device ID')">Add</a>&nbsp;
                        <a href="javascript:removeDeviceIdInput('divDeviceNone')">Remove</a>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnSetPermissionRights" style="margin-top:10px" onclick="clearApiResult();if(checkPermEventNameField('selSetPermRightsEventName')){setPermissionRights(getFieldValue('selSetPermRightsEventName'), getPermRightsToSet())}else{return false}">Set Rights</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        Check effective permission right:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right">
                        <label for="selCheckEffectivePermRight">Permission event: </label>
                    </td>
                    <td>
                        <select id="selCheckEffectivePermRight">
                            <option ></option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right">
                        <label for="itxObjDeviceId">Device ID: </label>
                    </td>
                    <td>
                        <input id="itxObjDeviceId" style="margin-bottom:0.5em" type="text" maxlength="40" size="40"/>
                        <br/><label for="cbxObjDeviceProdUniqId">product unique ID: </label><input id="cbxObjDeviceProdUniqId" type="checkbox"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnCheckEffectivePermRight" style="margin-top:10px" onclick="clearApiResult();if(checkPermEventNameField('selCheckEffectivePermRight') && checkDeviceIdField('itxObjDeviceId')){checkEffectivePermissionRight(getFieldValue('selCheckEffectivePermRight'),getFieldValue('itxObjDeviceId',true),isFieldChecked('cbxObjDeviceProdUniqId').toString())}else{return false}">Check Effective Right</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        Open WebSocket notification channel:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right">
                        <label for="selOpenNotifyEventName">Notification event: </label>
                    </td>
                    <td>
                        <select id="selOpenNotifyEventName">
                            <option ></option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnOpenWsNotifyChannel" style="margin-top:10px" onclick="if(checkNotifyEventNameField('selOpenNotifyEventName')){openWsNtfyChannel(getFieldValue('selOpenNotifyEventName'))}else{return false}">Open Notification Channel</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        Close WebSocket notification channel:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right">
                        <label for="selCloseNotifyEventName">Notification event: </label>
                    </td>
                    <td>
                        <select id="selCloseNotifyEventName">
                            <option ></option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnCloseWsNotifyChannel" style="margin-top:10px" onclick="if(checkNotifyEventNameField('selCloseNotifyEventName')){closeWsNtfyChannel(getFieldValue('selCloseNotifyEventName'))}else{return false}">Close Notification Channel</button>
                    </td>
                </tr>
            </table>
        </div>
        <div id="divAsset" style="margin-top:1em; display:none">
            <table>
                <tr>
                    <td colspan="2">
                        Issue asset:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="cbxReissue">Reissue an existing asset: </label>
                    </td>
                    <td>
                        <input id="cbxReissue" type="checkbox" onclick="setAssetIssueFields(this.checked)"/>
                    </td>
                </tr>
                <tr id="trAssetId" style="display:none">
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxAssetId">asset ID: </label>
                    </td>
                    <td>
                        <input id="itxAssetId" type="text" maxlength="20" size="20"/>
                    </td>
                </tr>
                <tr id="trAssetName">
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxAssetName">asset name: </label>
                    </td>
                    <td>
                        <input id="itxAssetName" type="text" maxlength="25" size="25"/>
                    </td>
                </tr>
                <tr id="trAssetDescription">
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxAssetDescription">asset description: </label>
                    </td>
                    <td>
                        <input id="itxAssetDescription" type="text" maxlength="80" size="80"/>
                    </td>
                </tr>
                <tr id="trCanReissue">
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="cbxCanReissue">can reissue: </label>
                    </td>
                    <td>
                        <input id="cbxCanReissue" type="checkbox"/>
                    </td>
                </tr>
                <tr id="trDecimalPlaces">
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxDecimalPlaces">decimal places: </label>
                    </td>
                    <td>
                        <input id="itxDecimalPlaces" type="text" maxlength="1" size="1"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxIssueAmount">amount: </label>
                    </td>
                    <td>
                        <input id="itxIssueAmount" type="text" maxlength="17" size="17"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" >
                        <label for="itxHoldDeviceId">Holding device ID: </label>
                    </td>
                    <td>
                        <input id="itxHoldDeviceId" style="margin-bottom:0.5em" type="text" maxlength="40" size="40"/>
                        <br/><label for="cbxProdUniqId2">product unique ID: </label><input id="cbxProdUniqId2" type="checkbox"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnIssueAsset" style="margin-top:8px" onclick="clearApiResult(); if(isFieldChecked('cbxReissue')){if(requireField('itxAssetId','asset ID',true,true) && requireField('itxIssueAmount','amount',true,true) && checkAmountField('itxIssueAmount')){reissueAsset(getFieldValue('itxAssetId',true),parseAmount(getFieldValue('itxIssueAmount')),checkUndefined(getFieldValue('itxHoldDeviceId',true)),isFieldChecked('cbxProdUniqId2'))}else{return false}}else{if(requireField('itxAssetName','asset name',true,true) && requireField('itxDecimalPlaces','value for decimal places',false,true) && checkNumberField('itxDecimalPlaces') && requireField('itxIssueAmount','amount',true,true) && checkAmountField('itxIssueAmount')){issueAsset(getFieldValue('itxAssetName',true),checkUndefined(getFieldValue('itxAssetDescription',true)),isFieldChecked('cbxCanReissue'),parseNumber(getFieldValue('itxDecimalPlaces')),parseAmount(getFieldValue('itxIssueAmount')),checkUndefined(getFieldValue('itxHoldDeviceId',true)),isFieldChecked('cbxProdUniqId2'))}else{return false}}">Issue Asset</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        Transfer asset:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxAssetId2">asset ID: </label>
                    </td>
                    <td>
                        <input id="itxAssetId2" type="text" maxlength="20" size="20"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxTransferAmount">amount: </label>
                    </td>
                    <td>
                        <input id="itxTransferAmount" type="text" maxlength="17" size="17"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" >
                        <label for="itxRecvDeviceId">Receiving device ID: </label>
                    </td>
                    <td>
                        <input id="itxRecvDeviceId" style="margin-bottom:0.5em" type="text" maxlength="40" size="40"/>
                        <br/><label for="cbxProdUniqId3">product unique ID: </label><input id="cbxProdUniqId3" type="checkbox"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnTransferAsset" style="margin-top:8px" onclick="clearApiResult(); if(requireField('itxAssetId2','asset ID',true,true) && requireField('itxTransferAmount','amount',true,true) && checkAmountField('itxTransferAmount') && checkDeviceIdField('itxRecvDeviceId','receiving',false,true)){transferAsset(getFieldValue('itxAssetId2',true),parseAmount(getFieldValue('itxTransferAmount')),getFieldValue('itxRecvDeviceId',true),isFieldChecked('cbxProdUniqId3'))}else{return false}">Transfer Asset</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        Retrieve asset info:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxAssetId3">asset ID: </label>
                    </td>
                    <td>
                        <input id="itxAssetId3" type="text" maxlength="20" size="20"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnAssetInfo" style="margin-top:8px" onclick="clearApiResult(); if(requireField('itxAssetId3','asset ID',true,true)){retrieveAssetInfo(getFieldValue('itxAssetId3',true))}else{return false}">Retrieve Info</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        Get asset balance:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxAssetId4">asset ID: </label>
                    </td>
                    <td>
                        <input id="itxAssetId4" type="text" maxlength="20" size="20"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnAssetBalance" style="margin-top:8px" onclick="clearApiResult(); if(requireField('itxAssetId4','asset ID',true,true)){getAssetBalance(getFieldValue('itxAssetId4',true))}else{return false}">Get Balance</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        List owned assets:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxLimit">maximum returned entries: </label>
                    </td>
                    <td>
                        <input id="itxLimit" type="text" maxlength="3" size="3"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxSkip">entries to skip: </label>
                    </td>
                    <td>
                        <input id="itxSkip" type="text" maxlength="10" size="10"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnOwnedAssets" style="margin-top:8px" onclick="clearApiResult(); if((checkUndefined(getFieldValue('itxLimit',true)) === undefined || checkNumberField('itxLimit')) && (checkUndefined(getFieldValue('itxSkip',true)) === undefined || checkNumberField('itxSkip'))){listOwnedAssets(parseNumber(checkUndefined(getFieldValue('itxLimit',true))),parseNumber(checkUndefined(getFieldValue('itxSkip',true))))}else{return false}">List assets</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        List issued assets:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxLimit2">maximum returned entries: </label>
                    </td>
                    <td>
                        <input id="itxLimit2" type="text" maxlength="3" size="3"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxSkip2">entries to skip: </label>
                    </td>
                    <td>
                        <input id="itxSkip2" type="text" maxlength="10" size="10"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnIssuedAssets" style="margin-top:8px" onclick="clearApiResult(); if((checkUndefined(getFieldValue('itxLimit2',true)) === undefined || checkNumberField('itxLimit2')) && (checkUndefined(getFieldValue('itxSkip2',true)) === undefined || checkNumberField('itxSkip2'))){listIssuedAssets(parseNumber(checkUndefined(getFieldValue('itxLimit2',true))),parseNumber(checkUndefined(getFieldValue('itxSkip2',true))))}else{return false}">List assets</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        Retrieve asset issuance history:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxAssetId5">asset ID: </label>
                    </td>
                    <td>
                        <input id="itxAssetId5" type="text" maxlength="20" size="20"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="idtStartDate2">start date: </label>
                    </td>
                    <td>
                        <input id="idtStartDate2" placeholder="YYYY-MM-dd HH:mm:ss" type="text" maxlength="25"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="idtEndDate2">end date: </label>
                    </td>
                    <td>
                        <input id="idtEndDate2" placeholder="YYYY-MM-dd HH:mm:ss" type="text" maxlength="25"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxLimit4">max. returned issuance events: </label>
                    </td>
                    <td>
                        <input id="itxLimit4" type="text" maxlength="3" size="3"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxSkip4">issuance events to skip: </label>
                    </td>
                    <td>
                        <input id="itxSkip4" type="text" maxlength="10" size="10"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnAssetIssuance" style="margin-top:8px" onclick="clearApiResult(); if(requireField('itxAssetId5','asset ID',true,true) && checkAssetIssuanceHistoryDateFields()){retrieveAssetIssuanceHistory(getFieldValue('itxAssetId5',true),formatDate(getFieldValue('idtStartDate2')),formatDate(getFieldValue('idtEndDate2')),parseNumber(checkUndefined(getFieldValue('itxLimit4',true))),parseNumber(checkUndefined(getFieldValue('itxSkip4',true))))}else{return false}">Retrieve issuance history</button>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" style="padding-top:1.25em">
                        List asset holders:
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxAssetId6">asset ID: </label>
                    </td>
                    <td>
                        <input id="itxAssetId6" type="text" maxlength="20" size="20"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxLimit3">maximum returned entries: </label>
                    </td>
                    <td>
                        <input id="itxLimit3" type="text" maxlength="3" size="3"/>
                    </td>
                </tr>
                <tr>
                    <td valign="top" align="right" style="padding-left:1em">
                        <label for="itxSkip3">entries to skip: </label>
                    </td>
                    <td>
                        <input id="itxSkip3" type="text" maxlength="10" size="10"/>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button id="btnAssetHolders" style="margin-top:8px" onclick="clearApiResult(); if(requireField('itxAssetId6','asset ID',true,true) && (checkUndefined(getFieldValue('itxLimit3',true)) === undefined || checkNumberField('itxLimit3')) && (checkUndefined(getFieldValue('itxSkip3',true)) === undefined || checkNumberField('itxSkip3'))){listAssetHolders(getFieldValue('itxAssetId6',true),parseNumber(checkUndefined(getFieldValue('itxLimit3',true))),parseNumber(checkUndefined(getFieldValue('itxSkip3',true))))}else{return false}">List holders</button>
                    </td>
                </tr>
            </table>
        </div>
        <table width="100%" style="margin-top:1em">
            <tr>
                <td valign="top" width="50%">
                    <div id="divApiResult">
                        <label>Catenis API Result:</label><br/>
                        <p id="pApiResult"></p>
                    </div>
                </td>
                <td valign="top" width="50%">
                    <div id="divNtfyChannelActivity">
                        <label>Notification channel activity:</label>&nbsp;&nbsp;<a href="javascript:clearWSActiviy()">Clear activity log</a><br/>
                        <p id="pNtfyChannelActivity"></p>
                    </div>
                </td>
            </tr>
        </table>
        <script language="JavaScript">
            clearApiResult();
            clearWSActiviy();
            initApiClient();
        </script>
    </body>
</html>